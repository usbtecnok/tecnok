<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>USB-TECNOK</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
<style>
body { margin:0; font-family: Arial, sans-serif; }
header { height: 60px; background:#004aad; color:white; display:flex; align-items:center; padding:0 20px; }
header img { height:40px; margin-right:15px; }
.botoes { padding:10px 20px; display:flex; gap:10px; flex-wrap:wrap; background:#e0e0e0; }
.botoes button { padding:10px 15px; border:none; border-radius:5px; cursor:pointer; background:#004aad; color:white; font-weight:bold; }
#map { width:100%; height:50vh; }
.painel { padding:10px 20px; background:#f1f1f1; height:calc(50vh - 20px); overflow:auto; }
#modalTermos { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
#modalTermos div { background:white; padding:20px; border-radius:8px; max-width:600px; }
</style>
</head>
<body>

<header>
  <img src="logotecnok.png" alt="Logo USB-TECNOK">
  <h1>USB-TECNOK</h1>
</header>

<div class="botoes">
  <button id="pedirCorrida">Pedir Corrida</button>
  <button id="botaoPanico">Botão de Pânico</button>
  <button id="torneMotorista">Torne-se Motorista Tecnok</button>
  <button id="tornePassageiro">Torne-se Passageiro Tecnok</button>
  <button id="compreSaldo">Compre Saldo</button>
  <button id="baixarApp">Baixar App Tecnok</button>
</div>

<div id="map"></div>
<div class="painel" id="painelMotorista">Painel do Motorista / Passageiro</div>

<!-- Modal de termos -->
<div id="modalTermos">
  <div>
    <h2>Termos de Uso - Tecnok</h2>
    <p>Aceito seguir todas as regras do Tecnok como motorista.</p>
    <button id="aceitoTermos">Aceito</button>
    <button id="recusoTermos">Recuso</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>
<script>
// Inicializa mapa
const map = L.map('map').setView([-22.9136, -43.2222], 11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
 attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>',
 maxZoom:19
}).addTo(map);

// Ícones
const iconMotorista = L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/61/61231.png', iconSize:[30,30]});
const iconPassageiro = L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/1077/1077042.png', iconSize:[25,25]});
const iconUsuario = L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/64/64113.png', iconSize:[30,30]});

// Marcador do usuário
let minhaPos = L.marker([-22.9136,-43.2222], {icon: iconUsuario}).bindPopup('Você está aqui').addTo(map);
if(navigator.geolocation){
 navigator.geolocation.watchPosition(pos=>{
   const lat=pos.coords.latitude;
   const lon=pos.coords.longitude;
   minhaPos.setLatLng([lat,lon]);
   map.setView([lat,lon],13);
 }, err=>console.error('Erro geolocalização:',err), {enableHighAccuracy:true});
}

// Marcadores
let markersMotoristas = {};
let markersPassageiros = {};

async function atualizarDados(){
 try{
   const res = await fetch('http://localhost:5000/api/dados');
   const data = await res.json();
   data.motoristas.forEach(m=>{
     if(markersMotoristas[m.id]) markersMotoristas[m.id].setLatLng([m.lat,m.lon]);
     else markersMotoristas[m.id] = L.marker([m.lat,m.lon],{icon:iconMotorista}).bindPopup(m.nome).addTo(map);
   });
   data.passageiros.forEach(p=>{
     if(markersPassageiros[p.id]) markersPassageiros[p.id].setLatLng([p.lat,p.lon]);
     else markersPassageiros[p.id] = L.marker([p.lat,p.lon],{icon:iconPassageiro}).bindPopup(p.nome).addTo(map);
   });
 } catch(e){ console.error('Erro ao atualizar dados:',e); }
}
setInterval(atualizarDados,3000);

// Botões
document.getElementById('pedirCorrida').onclick = ()=>alert('Pedido de corrida enviado!');
document.getElementById('botaoPanico').onclick = ()=>alert('Alerta de pânico ativado!');
document.getElementById('torneMotorista').onclick = ()=>document.getElementById('modalTermos').style.display='flex';
document.getElementById('tornePassageiro').onclick = ()=>alert('Cadastro passageiro Tecnok!');
document.getElementById('compreSaldo').onclick = ()=>alert('Página de compra de saldo!');
document.getElementById('baixarApp').onclick = ()=>window.location.href='https://seusite.com/tecnok.apk';

// Modal de termos
document.getElementById('aceitoTermos').onclick = async ()=>{
  const nome = prompt('Digite seu nome completo:');
  const email = prompt('Digite seu email:');
  if(!nome || !email){ alert('Preencha os campos!'); return; }
  await fetch('http://localhost:5000/api/motoristas', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({nome,email,status:'pendente'})
  });
  alert('Motorista cadastrado! Aguardando aprovação.');
  document.getElementById('modalTermos').style.display='none';
}

document.getElementById('recusoTermos').onclick = ()=>{
  alert('Você precisa aceitar os termos para se cadastrar.');
  document.getElementById('modalTermos').style.display='none';
}
</script>

</body>
</html>
